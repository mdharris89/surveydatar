% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pipeline.R
\name{add_col_from_lookup}
\alias{add_col_from_lookup}
\title{Add a column to tab results from a lookup table}
\usage{
add_col_from_lookup(
  tab_result,
  lookup_df,
  tab_key,
  lookup_key,
  lookup_value,
  new_col_name,
  tab_transform = NULL,
  lookup_transform = NULL,
  fuzzy = FALSE
)
}
\arguments{
\item{tab_result}{A \strong{materialized} tab_result object (use \code{as.data.frame(tab(...))})}

\item{lookup_df}{A data frame containing the lookup table}

\item{tab_key}{Character string naming the column in tab_result to use as key}

\item{lookup_key}{Character string naming the column in lookup_df to match against}

\item{lookup_value}{Character string naming the column in lookup_df with values to add}

\item{new_col_name}{Character string for the name of the new column to add}

\item{tab_transform}{Optional function to transform tab_key values before matching}

\item{lookup_transform}{Optional function to transform lookup_key values before matching}

\item{fuzzy}{Logical. If TRUE, uses partial string matching instead of exact matching}
}
\value{
A tab_result object with the new column added after the key column
}
\description{
Enriches a tab_result object by adding values from a lookup table based on
key matching. The new column is positioned directly after the key column.
Supports optional transformations of keys and fuzzy partial matching.
}
\details{
This function operates on \strong{materialized} tab_result objects only. Cell-based
results from \code{tab()} must first be converted using \code{as.data.frame()}. The added
column is for display/export purposes (e.g., \code{copy_tab()}, \code{print()}) and does
not participate in layout operations like \code{arrange_rows()} or \code{hide_cols()}.
}
\examples{
\dontrun{
# Example: Adding theme descriptions to a tab of theme tags
# Note: must materialize with as.data.frame() before add_col_from_lookup()
themes_lookup <- data.frame(
  theme_id = c("satisfaction", "wait_time", "staff_helpful"),
  theme_description = c(
    "Overall satisfaction with service",
    "Wait time was reasonable",
    "Staff were helpful and knowledgeable"
  )
)

result <- data \%>\%
  tab(theme_satisfaction, region) \%>\%
  as.data.frame() \%>\%
  add_col_from_lookup(
    themes_lookup,
    "row_label",
    "theme_id",
    "theme_description",
    "Theme"
  ) \%>\%
  copy_tab()  # Ready to paste with descriptions

# With transformations to clean up keys
result <- data \%>\%
  tab(q1, q2) \%>\%
  as.data.frame() \%>\%
  add_col_from_lookup(
    labels_df,
    "row_label",
    "label_code",
    "full_text",
    "Question Text",
    tab_transform = function(x) gsub("^Q1: ", "", x),
    lookup_transform = toupper
  )

# With fuzzy matching for partial matches
result <- data \%>\%
  tab(categories, dept) \%>\%
  as.data.frame() \%>\%
  add_col_from_lookup(
    category_descriptions,
    "row_label",
    "category_pattern",
    "long_description",
    "Description",
    fuzzy = TRUE
  )
}
}
