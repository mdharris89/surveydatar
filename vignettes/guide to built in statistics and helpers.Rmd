# Guide to built-in statistics and helpers  (note: this vignette not fully tested)

## Statistics

Below are all built-in statistics. Use the `statistic` argument in `tab()`; some also require a numeric `values` variable.

### 1. Count (count)

``` r
# Base counts by gender and region
tab(data, gender, region, statistic = "count")
```

### 2. Row percentage (row_pct)

``` r
# Share of each region within each brand row
tab(data, brand, region, statistic = "row_pct")
```

### 3. Column percentage (column_pct)

``` r
# Share of each brand within each region column
tab(data, brand, region, statistic = "column_pct")
```

### 4. Mean (mean)

``` r
# Average income by gender and region
tab(data, gender, region, statistic = "mean", values = "income")
```

### 5. Median (median)

``` r
# Median income by gender and region
tab(data, gender, region, statistic = "median", values = "income")
```

### 6. Standard deviation (sd)

``` r
# Income variability by demographic groups
tab(data, age_group, region, statistic = "sd", values = "income")
```

### 7. Coefficient of variation (cv)

``` r
# Relative variability of income (SD/Mean × 100)
tab(data, education_level, region, statistic = "cv", values = "income")
```

### 8. Percentiles (p25, p75)

``` r
# Income quartiles by demographics
tab(data, education_level, region, statistic = "p25", values = "income")
tab(data, education_level, region, statistic = "p75", values = "income")
```

### 9. Index (index)

``` r
# Over/under-index vs total (100 = average)
tab(data, gender, region, statistic = "index")
```

### 10. Correlation (correlation)

Requires numeric `rows` and `cols` variables.

``` r
# Correlation between satisfaction and loyalty
tab(data, satisfaction_score, loyalty_score, statistic = "correlation")
```

## Helpers

Helpers generate arrays for `rows`, `cols`, or filters. Listed from simplest/general to more specific.

### 1. Total (total)

``` r
# Overall totals crossed by gender
tab(data, total(), gender, statistic = "count")
```

### 2. Any positive (any_positive)

``` r
# Anyone selecting any of q1_1, q1_2, q1_3
tab(data, any_positive(c("q1_1", "q1_2", "q1_3")), gender)

# Using a question group name (if defined in dpdict)
tab(data, any_positive("q1"), region)
```

### 3. Top box (top_box)

``` r
# Top-2 box of a 5-point satisfaction scale
tab(data, top_box(satisfaction, 2), gender)
```

### 4. Bottom box (bottom_box)

``` r
# Bottom-2 box of a 5-point satisfaction scale
tab(data, bottom_box(satisfaction, 2), region)
```

### 5. Value range (value_range)

``` r
# Age 25–34 inclusive
tab(data, value_range(age, 25, 34), region)

# Exclusive boundaries
tab(data, value_range(satisfaction_score, 3, 4, inclusive = FALSE), product_type)
```

### 6. Percentile selection (percentile)

``` r
# Top 10% of spenders
tab(data, percentile(total_spend, "above", 90), product_category)

# Bottom quartile of engagement
tab(data, percentile(engagement_score, "below", 25), channel)
```

### 7. Pattern matching (pattern)

``` r
# Find specific mentions in comments
tab(data, pattern(comments, "excellent|outstanding"), gender)

# Email domain analysis
tab(data, pattern(email, "@gmail\\.com$"), age_group)
```

### 8. Response match (response_match)

``` r
# Match value labels within a question group into buckets
tab(data, response_match(c("Daily", "Weekly"), "usage_group"), gender)

# Automatically extract value labels for a group
tab(data, response_match(get_value_labels = "q1"), region)
```

### 9. All matching (all_matching)

``` r
# Return individual variables whose labels match the pattern within a group
tab(data, all_matching("Microsoft", "A1"), gender)
```

## Macro helpers (banner, calc_if + no_mismatch)

These operate at a higher level than single-variable helpers.

### Banner (banner)

``` r
# Cross an outer variable with an inner spec
tab(data, q1, banner(region, gender))

# Nest helpers inside banner
tab(data, q1, banner(region, top_box(satisfaction, 2)))

# With subtotals per outer category
tab(data, q1, banner(region, satisfaction, subtotals = TRUE))
```

### calc_if with no_mismatch gate

Use `calc_if(no_mismatch("ival"), ...)` to compute cells only when row and column share at least one matching metadata value (e.g., the same response option label stored in `ival`). Useful for orthogonal tables.

``` r
# Only compute cells when row and column refer to the same response (by ival)
tab(
  data,
  rows = calc_if(no_mismatch("ival"), response_match(get_value_labels = "q1")),
  cols = response_match(get_value_labels = "q1"),
  statistic = "count"
)
```

## Notes

- Helpers `index_to` and `change_from` are API placeholders; examples are omitted until implemented.
